{% extends 'base.html' %} {% block title %}| Admin Dashboard {% endblock %}
{% block content %}
<h3>Admin Dashboard</h3>

<div class="row mb-4">
  <div class="col-md-3">
    <div class="card p-3">
      <h5 class="mb-0">Doctors</h5>
      <div class="display-6">{{ doctors }}</div>
      <div class="mt-3">
        <a class="btn btn-sm btn-success" href="{{ url_for('main.add_doctor') }}">Add</a>
        <a class="btn btn-sm btn-secondary" href="{{ url_for('main.list_all_doctors') }}">Manage</a>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card p-3">
      <h5 class="mb-0">Patients</h5>
      <div class="display-6">{{ patients }}</div>
      <div class="mt-3">
        <a class="btn btn-sm btn-success" href="{{ url_for('main.add_patient') }}">Add</a>
        <a class="btn btn-sm btn-secondary" href="{{ url_for('main.list_patients') }}">Manage</a>
      </div>
    </div>
  </div>
  
  <div class="col-md-3">
    <div class="card p-3">
      <h5 class="mb-0">Departments</h5>
      <div class="display-6">{{ departments }}</div>
      <div class="mt-3">
        <a class="btn btn-sm btn-success" href="{{ url_for('main.add_department') }}">Add</a>
        <a class="btn btn-sm btn-secondary" href="{{ url_for('main.list_departments') }}">Manage</a>
      </div>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card p-3">
      <h5 class="mb-0">Appointments</h5>
      <div class="display-6">{{ appointments }}</div>
      <div class="mt-3">
         <a class="btn btn-sm btn-success" href="{{ url_for('main.add_department') }}">Add</a>
        <a class="btn btn-sm btn-secondary" href="{{ url_for('main.admin_appointments') }}">View Appointments</a>
      </div>
    </div>
  </div>

</div>

<hr>

<div class="row">
  <div class="col-md-6">
    <h5>Doctors</h5>
    <table class="table table-sm">
      <thead><tr><th>Name</th><th>Dept / Spec</th><th>Actions</th></tr></thead>
      <tbody>
        {% for d in doctors_list %}
        <tr>
          <td>{{ d.user.name }}</td>
          <td>
            {% if d.department %}{{ d.department.name }} &mdash; {% endif %}{{ d.specialization }}
          </td>
          <td>
            <a class="btn btn-sm btn-outline-primary" href="{{ url_for('main.edit_doctor', doctor_id=d.id) }}">Edit</a>

            <form method="post" action="{{ url_for('main.delete_doctor', doctor_id=d.id) }}"
                  style="display:inline" onsubmit="return confirmDelete('doctor','{{ d.user.name }}')">
              <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
              <button class="btn btn-sm btn-danger">Delete</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="3">No doctors found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="col-md-6">
    <h5>Patients</h5>
    <table class="table table-sm">
      <thead><tr><th>Name</th><th>Contact</th><th>Actions</th></tr></thead>
      <tbody>
        {% for p in patients_list %}
        <tr>
          <td>{{ p.user.name }}</td>
          <td>{{ p.contact or 'â€”' }}</td>
          <td>
            <a class="btn btn-sm btn-outline-primary" href="{{ url_for('main.edit_patient', patient_id=p.id) }}">Edit</a>

            <form method="post" action="{{ url_for('main.delete_patient', patient_id=p.id) }}"
                  style="display:inline" onsubmit="return confirmDelete('patient','{{ p.user.name }}')">
              <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
              <button class="btn btn-sm btn-danger">Delete</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="3">No patients found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
function confirmDelete(type, name){
  return confirm('Are you sure you want to delete the ' + type + ' \"' + name + '\"? This will deactivate the user.');
}
</script>

{% endblock %}
